#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Конфигурационный файл с параметрами манипулятора и камеры
"""

# Параметры манипулятора (в миллиметрах)
MANIPULATOR_CONFIG = {
    'BASE_HEIGHT': 50,        # Высота от основания до первой поворотной оси
    'SHOULDER_LENGTH': 85,    # Длина первого плеча
    'ELBOW_LENGTH': 70,      # Длина второго плеча
    'WRIST_LENGTH': 45,      # Длина захвата
    'GRIPPER_HEIGHT': 340,   # Общая высота в вертикальном положении
    'CENTER_PIXEL': {
        'X': 655    ,            # Обновленный центр X
        'Y': 672             # Обновленный центр Y
    },
    'SCALE_FACTOR': 0.366,     # Для конвертации из пикселей в мм
    'MIN_REACH': 150,       # Минимальное расстояние захвата
    'MAX_REACH': 400,       # Максимальное расстояние захвата
    'Z_OFFSET': 10,         # Смещение по высоте для захвата (мм)
    'TOLERANCE': 5,         # Допустимое отклонение (мм)
    'GRIPPER_LENGTH': 50,    # Размер клешни до зоны захвата (мм)
    'CUBE_HEIGHT': 5,       # Стандартная высота кубика (мм)
    'DOF': 4,               # Степени свободы
    'HAS_GRIPPER': True,    # Наличие захвата
    'JOINT_LIMITS': {        # Ограничения углов сервоприводов
        'BASE': (0, 180),
        'SHOULDER': (0, 180),
        'ELBOW': (0, 180),
        'WRIST': (0, 180),
    },
    'WORK_AREA': {          # Параметры рабочей области
        'MIN_RADIUS': 120,    # Минимальный радиус
        'MAX_RADIUS': 300,   # Максимальный радиус
        'MIN_HEIGHT': 0,     # Минимальная высота
        'MAX_HEIGHT': 340,   # Максимальная высота
    }
}

# Сетевые параметры
NETWORK_CONFIG = {
    'DEFAULT_IP': '192.168.10.10',
    'DEFAULT_PORT': 80,
    'CONNECTION_TIMEOUT': 10,     # Увеличен таймаут до 10 секунд
    'MAX_RETRIES': 3,            # Количество попыток переподключения
    'RETRY_DELAY': 1             # Задержка между попытками в секундах
}

# Параметры камеры (в миллиметрах)
CAMERA_CONFIG = {
    'height': 550,           # Высота установки камеры
    'angle': 0,             # Угол наклона камеры (0 - перпендикулярно поверхности)
    'fov': 60,             # Угол обзора камеры (в градусах)
    'resolution': {
        'width': 1280,      # Ширина кадра
        'height': 720       # Высота кадра
    }
}

# Параметры калибровки
CALIBRATION_CONFIG = {
    'min_points': 4,        # Минимальное количество точек для калибровки
    'grid_size': 5,        # Размер калибровочной сетки (5x5)
    'point_distance': 40,   # Расстояние между калибровочными точками (мм)
}

# Параметры сервоприводов
SERVO_CONFIG = {
    'base': {              # Сервопривод основания
        'min_angle': 0,
        'max_angle': 180,
        'default': 90
    },
    'shoulder': {          # Сервопривод плеча
        'min_angle': 0,
        'max_angle': 180,
        'default': 90
    },
    'elbow': {            # Сервопривод локтя
        'min_angle': 0,
        'max_angle': 180,
        'default': 90
    },
    'wrist': {            # Сервопривод кисти
        'min_angle': 0,
        'max_angle': 180,
        'default': 90
    },
    'gripper': {          # Сервопривод захвата
        'min_angle': 0,
        'max_angle': 180,
        'default': 90,
        'open_angle': 180,
        'close_angle': 60
    }
}

# Параметры калибровки и интерполяции
CALIBRATION_POINTS = {
    'distance_points': [
        # Первый квадрант (существующие точки)
        {'pixel_x': 986, 'pixel_y': 208},
        {'pixel_x': 969, 'pixel_y': 242},
        {'pixel_x': 936, 'pixel_y': 274},
        {'pixel_x': 902, 'pixel_y': 307},
        {'pixel_x': 867, 'pixel_y': 356},
        {'pixel_x': 823, 'pixel_y': 365},
        {'pixel_x': 822, 'pixel_y': 394},
        # Второй квадрант (новые точки)
        {'pixel_x': 350, 'pixel_y': 124},
        {'pixel_x': 368, 'pixel_y': 167},
        {'pixel_x': 391, 'pixel_y': 203},
        {'pixel_x': 353, 'pixel_y': 250},
        {'pixel_x': 426, 'pixel_y': 289}
    ],
    'shoulder_angles': [
        # Первый квадрант
        34, 40, 43, 49, 51, 53, 53,
        # Второй квадрант
        27, 34, 38, 41, 48
    ],
    'elbow_angles': [
        # Первый квадрант
        122, 139, 149, 159, 175, 180, 180,
        # Второй квадрант
        102, 128, 138, 151, 163
    ],
    'wrist_angles': [
        # Первый квадрант
        80, 85, 76, 82, 82, 63, 58,
        # Второй квадрант
        80, 81, 81, 81, 81
    ]
}

# Коррекции угла основания для четвертей
QUADRANT_CORRECTIONS = {
    1: -8,    # Первая четверть
    2: -2,    # Вторая четверть
    3: -3,    # Третья четверть
    4: -3     # Четвертая четверть
}

# Параметры буферной зоны между четвертями
QUADRANT_BUFFER = {
    'width': 15,  # ширина буферной зоны в мм
    'enabled': True,  # включение/отключение буферной зоны
    'all_borders': True  # обрабатывать все границы четвертей (не только между 1 и 2)
}

# Параметры захвата объектов
GRAB_SEQUENCE = {
    'z_offset': 0,  # Базовое смещение по высоте для захвата (мм)
    'delays': {
        'initial': 1.5,     # Задержка после установки исходного положения
        'rotation': 0.7,    # Увеличена задержка после поворота основания для стабилизации
        'positioning': 1.8, # Увеличена задержка перед захватом для точной установки
    },
    'speed': {
        'wrist': 0.5,      # Уменьшена скорость для более плавного движения
        'elbow': 0.9,      # Уменьшена скорость для более плавного движения
        'shoulder': 0.7,   # Уменьшена скорость для более плавного движения
        'base': 0.7,       # Скорость поворота основания
        'gripper_open': 0.5,   # Скорость открытия захвата
        'gripper_close': 1.0,  # Уменьшена скорость для более надежного захвата
    },
    'initial_position': {
        'wrist': 90,      # Начальный угол кисти
        'elbow': 90,      # Начальный угол локтя
        'shoulder': 90,   # Начальный угол плеча
        'base': 90,       # Начальный угол основания
        'speed_wrist': 0.5,    # Скорость установки кисти в исходное положение
        'speed_elbow': 1.0,    # Уменьшена скорость для более стабильного движения
        'speed_shoulder': 0.5, # Скорость установки плеча в исходное положение
        'speed_base': 0.5,     # Скорость установки основания в исходное положение
    }
}

# Параметры подключения для манипулятора
MANIPULATOR_CONNECTION = {
    'ip': "192.168.0.10",
    'port': 2000
}

# Цветовые диапазоны HSV
# Формат: (Нижняя граница, Верхняя граница)
# Красный цвет использует два диапазона из-за пересечения в HSV
COLOR_RANGES = {
    'red': [
        ((0, 120, 70), (10, 255, 255)),
        ((170, 120, 70), (180, 255, 255))
    ],
    'green': [
        ((35, 80, 40), (85, 255, 255))
    ],
    'blue': [
        ((90, 80, 40), (130, 255, 255))
    ],
    'orange': [
        ((10, 100, 100), (25, 255, 255))
    ]
}